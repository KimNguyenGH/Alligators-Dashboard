col_types = cols(id = col_character())) %>%
select(id, text = full_text, year)
reg <- "([^A-Za-z\\d#@']|'(?![A-Za-z\\d#@]))"
twenty_words <-
twenty %>%
filter(!str_detect(text, '^"')) %>%
mutate(text = str_replace_all(text,
"https://t.co/[A-Za-z\\d]+|&amp;",
"")) %>%
unnest_tokens(word, text,
token = "regex",
pattern = reg) %>%
filter(!word %in% stop_words$word,
str_detect(word, "[a-z]"))
twentyone_words <-
twentyone %>%
filter(!str_detect(text, '^"')) %>%
mutate(text = str_replace_all(text,
"https://t.co/[A-Za-z\\d]+|&amp;",
"")) %>%
unnest_tokens(word, text,
token = "regex",
pattern = reg) %>%
filter(!word %in% stop_words$word,
str_detect(word, "[a-z]"))
twenty_most_common <-
twenty_words %>%
count(word, sort = TRUE) %>%
head(20) %>%
mutate(word = reorder(word, n))
graph1 <-
ggplotly(
twenty_most_common %>%
ggplot(aes(x = word, y = n)) +
geom_bar(stat = "identity") +
ylab("Occurrences") +
coord_flip() +
ggtitle("2020 COVID-19 Tweets Word Frequency")
)
twentyone_most_common <-
twentyone_words %>%
count(word, sort = TRUE) %>%
head(20) %>%
mutate(word = reorder(word, n))
graph2 <-
ggplotly(
twentyone_most_common %>%
ggplot(aes(x = word, y = n)) +
geom_bar(stat = "identity") +
ylab("Occurrences") +
coord_flip() +
ggtitle("2021 COVID-19 Tweets Word Frequency")
)
#added - common words by proportion
compare_most_common <- full_join(twenty_most_common, twentyone_most_common, by = "word")
colnames(compare_most_common) <- c("Word", "2020", "2021")
# most common words by proportion 2020
compare_most_common %>%  mutate(`2020 proportion` = compare_most_common$`2020`/4666) -> prp_twenty_most_common
prp_twenty_most_common[!is.na(prp_twenty_most_common$`2020 proportion`),] -> prp_twenty_most_common
prp_twenty_most_common %>%  select("Word",`2020 proportion`) %>% arrange(-`2020 proportion`) -> prp_twenty_most_common
# most common words by proportion 2021
compare_most_common %>%  mutate(`2021 proportion` = compare_most_common$`2021`/5341) -> prp_twentyone_most_common
prp_twentyone_most_common[!is.na(prp_twentyone_most_common$`2021 proportion`),] -> prp_twentyone_most_common
prp_twentyone_most_common %>%  select("Word",`2021 proportion`) %>% arrange(-`2021 proportion`) -> prp_twentyone_most_common
#graph
prpgraph_twenty_most_common <-
ggplotly(
prp_twenty_most_common %>%
ggplot(aes(x = Word, y = `2020 proportion`)) +
geom_bar(stat = "identity" , fill="#1DA1F2") +
xlab("word") +
ylab("Relative Frequency") +
coord_flip() +
ggtitle("2020 COVID-19 Tweets Words Rel. Freq.")
)
prpgraph_twentyone_most_common <-
ggplotly(
prp_twentyone_most_common %>%
ggplot(aes(x = reorder(Word, `2021 proportion`), y = (`2021 proportion`)) ) +
geom_bar(stat = "identity", fill="#1DA1F2") +
xlab("word") +
ylab("Relative Frequency") +
coord_flip() +
ggtitle("2021 COVID-19 Tweets Words Rel. Freq.")
)
##
twenty_cloud <-
twenty_words  %>%
count(word) %>%
arrange(-n)
twentyone_cloud <-
twentyone_words  %>%
count(word) %>%
arrange(-n)
twenty_wordcounts <-
twenty %>%
mutate(tweetLength = str_length(text)) %>%
filter(tweetLength < 500)
twentyone_wordcounts <-
twentyone %>%
mutate(tweetLength = str_length(text)) %>%
filter(tweetLength < 500)
nrc <- read_rds("nrc.rds")
twenty_sentiment <-
inner_join(twenty_words, nrc, by = "word")
twentyone_sentiment <-
inner_join(twentyone_words, nrc, by = "word")
twenty_sentiment_analysis <-
twenty_sentiment %>%
count(word, sentiment) %>%
group_by(sentiment)
graph3 <-
ggplotly(
twenty_sentiment_analysis %>%
summarize(sum(n)) %>%
ungroup() %>%
top_n(15) %>%
ggplot(aes(x = sentiment, y = `sum(n)` )) +
geom_bar(stat = "identity", fill="#1DA1F2") +
coord_flip() +
ylab("Frequency") +
xlab("Sentiment") +
labs(title="30 Mar 2020 Sentiments")
)
twentyone_sentiment_analysis <-
twentyone_sentiment %>%
count(word, sentiment) %>%
group_by(sentiment)
graph4 <-
ggplotly(
twentyone_sentiment_analysis %>%
summarize(sum(n)) %>%
ungroup() %>%
top_n(15) %>%
ggplot(aes(x = sentiment, y = `sum(n)` )) +
geom_bar(stat = "identity", fill="#1DA1F2") +
coord_flip() +
ylab("Frequency") +
xlab("Sentiment") +
labs(title="30 Mar 2021 Sentiments")
)
twenty_sentiment_analysis %>% filter(!sentiment %in% c("positive", "negative")) %>%
mutate(sentiment = reorder(sentiment, -n),
word = reorder(word, -n)) %>% top_n(10) -> twenty_sentiment_analysis2
graph5 <-
ggplotly(
ggplot(twenty_sentiment_analysis2, aes(x=word, y=n, fill = n)) +
facet_wrap(~ sentiment, scales = "free")+
geom_bar(stat ="identity", fill="#1DA1F2") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(y="count", title="30 Mar 2020 Sentiment Words")
)
twentyone_sentiment_analysis %>% filter(!sentiment %in% c("positive", "negative")) %>%
mutate(sentiment = reorder(sentiment, -n),
word = reorder(word, -n)) %>% top_n(10) -> twentyone_sentiment_analysis2
graph6 <-
ggplotly(
ggplot(twentyone_sentiment_analysis2, aes(x=word, y=n, fill = n)) +
facet_wrap(~ sentiment, scales = "free")+
geom_bar(stat ="identity", fill="#1DA1F2") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(y="count", title="30 Mar 2021 Sentiment Words")
)
# sentiment breakdown
twenty_sentiment_analysis2 %>%
ggplot(aes(x=n, y=1, label=word)) +
facet_grid(~sentiment) +
geom_point(color = "transparent") +
geom_text(aes(color=sentiment)) +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
panel.border = element_rect("lightgray", fill = NA),
legend.position = "none",
plot.title = element_text(hjust = 0.5, face="bold", size=17,
lineheight = 0.9),
axis.title = element_text(face="bold",size = (12))) +
xlab("Count") + ylab("Words") +
ggtitle("2020 Sentiment Breakdown") +
coord_flip()  -> twenty_sentiment_analysis4
ggplotly(twenty_sentiment_analysis4,
tooltip=c("sentiment","word","n")) ->  twenty_sentiment_analysis4
twenty_sentiment_analysis4
twentyone_sentiment_analysis2 %>%
ggplot(aes(x=n, y=1, label=word)) +
facet_grid(~sentiment) +
geom_point(color = "transparent") +
geom_text(aes(color=sentiment)) +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
panel.border = element_rect("lightgray", fill = NA),
legend.position = "none",
plot.title = element_text(hjust = 0.5, face="bold", size=17,
lineheight = 0.9),
axis.title = element_text(face="bold",size = (12))) +
xlab("Count") + ylab("Words") +
ggtitle("2021 Sentiment Breakdown") +
coord_flip() -> twentyone_sentiment_analysis4
ggplotly(twentyone_sentiment_analysis4,
tooltip=c("sentiment","word","n")) ->  twentyone_sentiment_analysis4
twentyone_sentiment_analysis4
afinn <- read_csv('afinn.csv')
twenty_afinn <-
inner_join(twenty_words,
afinn,
by = "word")
twentyone_afinn <-
inner_join(twentyone_words,
afinn,
by = "word")
twenty_mean_afinn <-
twenty_afinn %>%
summarise(mean = mean(value))
twentyone_mean_afinn <-
twentyone_afinn %>%
summarise(mean_tt_afinn = mean(value))
twenty_nested <-
twenty_words %>%
group_by(id) %>%
nest(word = word) %>%
mutate(text = paste(word %>% unlist(), collapse = ' ')) %>%
ungroup()
twenty_toDfm <-
lapply(X = twenty_nested$text,
FUN = function(t) gsub(pattern = "'",
replacement = "",
x = t)) %>%
unlist()
twenty_dfm <-
dfm(twenty_toDfm,
remove = c(stopwords("english")),
stem = T,
removePunct = T,
removeSeparators = T,
removeNumbers = T,
removeSymbols = T,
verbose = T)
set.seed(1)
tmod_twenty <- textmodel_lda(twenty_dfm, k = 10)
library(flexdashboard)
library(plotly)
library(htmltools)
library(rmarkdown)
library(tidyverse)
library(scales)
library(tidytext)
library(wordcloud)
library(textdata)
library(ranger)
library(caret)
library(vip)
library(kableExtra)
library(tm)
library(topicmodels)
library(reshape2)
library(ggplot2)
library(pals)
library(quanteda)
library(seededlda)
library(newsmap)
library(maps)
library(LSX)
library(quanteda.textstats)
library(quanteda.textplots)
library(SnowballC)
library(gt)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
twenty <-
read_csv('03-30-2020.csv',
col_types = cols(id = col_character())) %>%
select(id, text = full_text, year)
twentyone <-
read_csv('03-30-2021.csv',
col_types = cols(id = col_character())) %>%
select(id, text = full_text, year)
reg <- "([^A-Za-z\\d#@']|'(?![A-Za-z\\d#@]))"
twenty_words <-
twenty %>%
filter(!str_detect(text, '^"')) %>%
mutate(text = str_replace_all(text,
"https://t.co/[A-Za-z\\d]+|&amp;",
"")) %>%
unnest_tokens(word, text,
token = "regex",
pattern = reg) %>%
filter(!word %in% stop_words$word,
str_detect(word, "[a-z]"))
twentyone_words <-
twentyone %>%
filter(!str_detect(text, '^"')) %>%
mutate(text = str_replace_all(text,
"https://t.co/[A-Za-z\\d]+|&amp;",
"")) %>%
unnest_tokens(word, text,
token = "regex",
pattern = reg) %>%
filter(!word %in% stop_words$word,
str_detect(word, "[a-z]"))
twenty_most_common <-
twenty_words %>%
count(word, sort = TRUE) %>%
head(20) %>%
mutate(word = reorder(word, n))
graph1 <-
ggplotly(
twenty_most_common %>%
ggplot(aes(x = word, y = n)) +
geom_bar(stat = "identity") +
ylab("Occurrences") +
coord_flip() +
ggtitle("2020 COVID-19 Tweets Word Frequency")
)
twentyone_most_common <-
twentyone_words %>%
count(word, sort = TRUE) %>%
head(20) %>%
mutate(word = reorder(word, n))
graph2 <-
ggplotly(
twentyone_most_common %>%
ggplot(aes(x = word, y = n)) +
geom_bar(stat = "identity") +
ylab("Occurrences") +
coord_flip() +
ggtitle("2021 COVID-19 Tweets Word Frequency")
)
#added - common words by proportion
compare_most_common <- full_join(twenty_most_common, twentyone_most_common, by = "word")
colnames(compare_most_common) <- c("Word", "2020", "2021")
# most common words by proportion 2020
compare_most_common %>%  mutate(`2020 proportion` = compare_most_common$`2020`/4666) -> prp_twenty_most_common
prp_twenty_most_common[!is.na(prp_twenty_most_common$`2020 proportion`),] -> prp_twenty_most_common
prp_twenty_most_common %>%  select("Word",`2020 proportion`) %>% arrange(-`2020 proportion`) -> prp_twenty_most_common
# most common words by proportion 2021
compare_most_common %>%  mutate(`2021 proportion` = compare_most_common$`2021`/5341) -> prp_twentyone_most_common
prp_twentyone_most_common[!is.na(prp_twentyone_most_common$`2021 proportion`),] -> prp_twentyone_most_common
prp_twentyone_most_common %>%  select("Word",`2021 proportion`) %>% arrange(-`2021 proportion`) -> prp_twentyone_most_common
#graph
prpgraph_twenty_most_common <-
ggplotly(
prp_twenty_most_common %>%
ggplot(aes(x = Word, y = `2020 proportion`)) +
geom_bar(stat = "identity" , fill="firebrick") +
xlab("word") +
ylab("Relative Frequency") +
coord_flip() +
ggtitle("2020 COVID-19 Tweets Words Rel. Freq.")
)
prpgraph_twentyone_most_common <-
ggplotly(
prp_twentyone_most_common %>%
ggplot(aes(x = reorder(Word, `2021 proportion`), y = (`2021 proportion`)) ) +
geom_bar(stat = "identity", fill="firebrick") +
xlab("word") +
ylab("Relative Frequency") +
coord_flip() +
ggtitle("2021 COVID-19 Tweets Words Rel. Freq.")
)
##
twenty_cloud <-
twenty_words  %>%
count(word) %>%
arrange(-n)
twentyone_cloud <-
twentyone_words  %>%
count(word) %>%
arrange(-n)
twenty_wordcounts <-
twenty %>%
mutate(tweetLength = str_length(text)) %>%
filter(tweetLength < 500)
twentyone_wordcounts <-
twentyone %>%
mutate(tweetLength = str_length(text)) %>%
filter(tweetLength < 500)
nrc <- read_rds("nrc.rds")
twenty_sentiment <-
inner_join(twenty_words, nrc, by = "word")
twentyone_sentiment <-
inner_join(twentyone_words, nrc, by = "word")
twenty_sentiment_analysis <-
twenty_sentiment %>%
count(word, sentiment) %>%
group_by(sentiment)
graph3 <-
ggplotly(
twenty_sentiment_analysis %>%
summarize(sum(n)) %>%
ungroup() %>%
top_n(15) %>%
ggplot(aes(x = sentiment, y = `sum(n)` )) +
geom_bar(stat = "identity", fill="firebrick") +
coord_flip() +
ylab("Frequency") +
xlab("Sentiment") +
labs(title="30 Mar 2020 Sentiments")
)
twentyone_sentiment_analysis <-
twentyone_sentiment %>%
count(word, sentiment) %>%
group_by(sentiment)
graph4 <-
ggplotly(
twentyone_sentiment_analysis %>%
summarize(sum(n)) %>%
ungroup() %>%
top_n(15) %>%
ggplot(aes(x = sentiment, y = `sum(n)` )) +
geom_bar(stat = "identity", fill="firebrick") +
coord_flip() +
ylab("Frequency") +
xlab("Sentiment") +
labs(title="30 Mar 2021 Sentiments")
)
twenty_sentiment_analysis %>% filter(!sentiment %in% c("positive", "negative")) %>%
mutate(sentiment = reorder(sentiment, -n),
word = reorder(word, -n)) %>% top_n(10) -> twenty_sentiment_analysis2
graph5 <-
ggplotly(
ggplot(twenty_sentiment_analysis2, aes(x=word, y=n, fill = n)) +
facet_wrap(~ sentiment, scales = "free")+
geom_bar(stat ="identity", fill="firebrick") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(y="count", title="30 Mar 2020 Sentiment Words")
)
twentyone_sentiment_analysis %>% filter(!sentiment %in% c("positive", "negative")) %>%
mutate(sentiment = reorder(sentiment, -n),
word = reorder(word, -n)) %>% top_n(10) -> twentyone_sentiment_analysis2
graph6 <-
ggplotly(
ggplot(twentyone_sentiment_analysis2, aes(x=word, y=n, fill = n)) +
facet_wrap(~ sentiment, scales = "free")+
geom_bar(stat ="identity", fill="firebrick") +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(y="count", title="30 Mar 2021 Sentiment Words")
)
# sentiment breakdown
twenty_sentiment_analysis2 %>%
ggplot(aes(x=n, y=1, label=word)) +
facet_grid(~sentiment) +
geom_point(color = "transparent") +
geom_text(aes(color=sentiment)) +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
panel.border = element_rect("lightgray", fill = NA),
legend.position = "none",
plot.title = element_text(hjust = 0.5, face="bold", size=17,
lineheight = 0.9),
axis.title = element_text(face="bold",size = (12))) +
xlab("Count") + ylab("Words") +
ggtitle("2020 Sentiment Breakdown") +
coord_flip()  -> twenty_sentiment_analysis4
ggplotly(twenty_sentiment_analysis4,
tooltip=c("sentiment","word","n")) ->  twenty_sentiment_analysis4
twenty_sentiment_analysis4
twentyone_sentiment_analysis2 %>%
ggplot(aes(x=n, y=1, label=word)) +
facet_grid(~sentiment) +
geom_point(color = "transparent") +
geom_text(aes(color=sentiment)) +
theme(panel.grid = element_blank(),
axis.text.x = element_blank(),
panel.border = element_rect("lightgray", fill = NA),
legend.position = "none",
plot.title = element_text(hjust = 0.5, face="bold", size=17,
lineheight = 0.9),
axis.title = element_text(face="bold",size = (12))) +
xlab("Count") + ylab("Words") +
ggtitle("2021 Sentiment Breakdown") +
coord_flip() -> twentyone_sentiment_analysis4
ggplotly(twentyone_sentiment_analysis4,
tooltip=c("sentiment","word","n")) ->  twentyone_sentiment_analysis4
twentyone_sentiment_analysis4
afinn <- read_csv('afinn.csv')
twenty_afinn <-
inner_join(twenty_words,
afinn,
by = "word")
twentyone_afinn <-
inner_join(twentyone_words,
afinn,
by = "word")
twenty_mean_afinn <-
twenty_afinn %>%
summarise(mean = mean(value))
twentyone_mean_afinn <-
twentyone_afinn %>%
summarise(mean_tt_afinn = mean(value))
twenty_nested <-
twenty_words %>%
group_by(id) %>%
nest(word = word) %>%
mutate(text = paste(word %>% unlist(), collapse = ' ')) %>%
ungroup()
twenty_toDfm <-
lapply(X = twenty_nested$text,
FUN = function(t) gsub(pattern = "'",
replacement = "",
x = t)) %>%
unlist()
twenty_dfm <-
dfm(twenty_toDfm,
remove = c(stopwords("english")),
stem = T,
removePunct = T,
removeSeparators = T,
removeNumbers = T,
removeSymbols = T,
verbose = T)
set.seed(1)
tmod_twenty <- textmodel_lda(twenty_dfm, k = 10)
